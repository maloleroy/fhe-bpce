stages:
  - check

rust_stable:
  stage: check
  tags:
    - docker
  image: rust:latest
  before_script:
    - rustc --version
    - rustup component add clippy rustfmt
    - apt update -y
    - apt upgrade -y
    - apt install -y clang cmake # required for sealy
  script:
    - cargo build
    - cargo fmt -- --check
    - cargo clippy -- -D warnings
    - cargo test --workspace

rust_nightly_miri:
  stage: check
  tags:
    - docker
  image: rustlang/rust:nightly
  before_script:
    - rustup component add miri
  script:
    - cargo miri test -p fhe-core
